/*! videojs-markers - v0.5.0 - 2018-04-06
* Copyright (c) 2018 ; Licensed  */

"use strict";!function(x,e,r){var y={markerStyle:{width:"7px","border-radius":"30%","background-color":"red"},markerTip:{display:!0,text:function(e){return"Break: "+e.text},time:function(e){return e.time}},breakOverlay:{display:!1,displayTime:3,text:function(e){return"Break overlay: "+e.overlayText},style:{width:"100%",height:"20%","background-color":"rgba(0,0,0,0.7)",color:"white","font-size":"17px"}},onMarkerClick:function(e){},onMarkerReached:function(e){},markers:[]};e.registerPlugin("markers",function(n){var o=x.extend(!0,{},y,n),s={},l=[],m=x(this.el()),c=-1,k=this,d=null,a=null,v=-1;function u(){l.sort(function(e,r){return o.markerTip.time(e)-o.markerTip.time(r)})}function r(e){x.each(e,function(e,r){var i,t,a;r.key=(i=(new Date).getTime(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=(i+16*Math.random())%16|0;return i=Math.floor(i/16),("x"==e?r:3&r|8).toString(16)})),m.find(".vjs-progress-control").append((t=r,(a=x("<div class='vjs-marker'></div>")).css(o.markerStyle).css({"margin-left":-parseFloat(a.css("width"))/2+"px",left:f(t)+"%"}).attr("data-marker-key",t.key).attr("data-marker-time",o.markerTip.time(t)),t.class&&a.addClass(t.class),a.on("click",function(e){var r=!1;if("function"==typeof o.onMarkerClick&&(r=0==o.onMarkerClick(t)),!r){var i=x(this).data("marker-key");k.currentTime(o.markerTip.time(s[i]))}}),o.markerTip.display&&a.on("mouseover",function(){var e=s[x(this).data("marker-key")];d.find(".vjs-tip-inner").html(o.markerTip.text(e)),d.css({left:f(e)+"%",visibility:"visible"})}).on("mouseout",function(){d.css("visibility","hidden")}),a)),s[r.key]=r,l.push(r)}),u()}function f(e){return o.markerTip.time(e)/k.duration()*100}function i(e){a&&(v=-1,a.css("visibility","hidden")),c=-1;for(var r=0;r<e.length;r++){var i=e[r],t=l[i];t&&(delete s[t.key],l[i]=null,m.find(".vjs-marker[data-marker-key='"+t.key+"']").remove())}for(r=l.length-1;0<=r;r--)null===l[r]&&l.splice(r,1);u()}function e(){if(o.breakOverlay.display&&!(c<0)){var e=k.currentTime(),r=l[c],i=o.markerTip.time(r);i<=e&&e<=i+o.breakOverlay.displayTime?(v!=c&&(v=c,a.find(".vjs-break-overlay-text").text(o.breakOverlay.text(r))),a.css("visibility","visible")):(v=-1,a.css("visibility","hidden"))}}function t(){!function(){var e,r=function(e){return e<l.length-1?o.markerTip.time(l[e+1]):k.duration()},i=k.currentTime();if(-1!=c){var t=r(c);if(i>=o.markerTip.time(l[c])&&i<t)return;if(c===l.length-1&&i===k.duration())return}if(0<l.length&&i<o.markerTip.time(l[0]))e=-1;else for(var a=0;a<l.length;a++)if(t=r(a),i>=o.markerTip.time(l[a])&&i<t){e=a;break}e!=c&&(-1!=e&&n.onMarkerReached&&n.onMarkerReached(l[e]),c=e)}(),e()}function p(){o.markerTip.display&&(d=x("<div class='vjs-tip'><div class='vjs-tip-arrow'></div><div class='vjs-tip-inner'></div></div>"),m.find(".vjs-progress-control").append(d)),k.markers.removeAll(),r(n.markers),o.breakOverlay.display&&(a=x("<div class='vjs-break-overlay'><div class='vjs-break-overlay-text'></div></div>").css(o.breakOverlay.style),m.append(a),v=-1),t(),k.on("timeupdate",t)}k.on("loadedmetadata",function(){p()}),k.markers={getMarkers:function(){return l},next:function(){for(var e=k.currentTime(),r=0;r<l.length;r++){var i=o.markerTip.time(l[r]);if(e<i){k.currentTime(i);break}}},prev:function(){for(var e=k.currentTime(),r=l.length-1;0<=r;r--){var i=o.markerTip.time(l[r]);if(i+.5<e){k.currentTime(i);break}}},add:function(e){r(e)},remove:function(e){i(e)},removeAll:function(){for(var e=[],r=0;r<l.length;r++)e.push(r);i(e)},updateTime:function(){!function(){for(var e=0;e<l.length;e++){var r=l[e],i=m.find(".vjs-marker[data-marker-key='"+r.key+"']"),t=o.markerTip.time(r);i.data("marker-time")!=t&&i.css({left:f(r)+"%"}).attr("data-marker-time",t)}u()}()},reset:function(e){k.markers.removeAll(),r(e)},destroy:function(){k.markers.removeAll(),a.remove(),d.remove(),k.off("timeupdate",e),delete k.markers}}})}(jQuery,window.videojs);